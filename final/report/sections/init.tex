\section{Initialization}

\subsection{Manual}
As suggested in the project statement, manual initialization
was implemented first to evaluate the fitting algorithm and
the automatic initialization separately.

The implementation is pretty straightforward. Using different
OpenCV routines, the mean shape can be dragged to its initial
position, and once it has been placed, the fitting algorithm starts.

Nevertheless, this procedure presents a problem. The rotation of the
shape can't be changed, which causes the initial estimation to not be
as accurate as it could.

\subsection{Automatic}

What really would make a difference in object detection is to make it automatic,
and not having to drag a shape, for each object to be detected, in each image.
Our first approach to make an automatic model was using histogram of oriented
gradients (HOG), combined with training a support vector machine (SVM), to
detect the shape of the 8 incisors altogether. But we stumbled upon an
obstacle. Whereas with other images (much more clear, less noise, with highly
detailed edges) this method is feasible, with our images it was not as good,
even after "cleaning" the image (such as denoising, white and
black hat...) The following images represent an example with a normal image, 
and one cropped section of incisors, from radiograph1.

\begin{figure}[h]
  \centering
  \includegraphics[height=6cm]{img/astro_hog}
  \caption{Normal image and its HOG}
\end{figure}

\begin{figure}[h]
  \centering
  \includegraphics[height=5cm]{img/teeth_hog}
  \caption{Cropped teeth section}
\end{figure}

After that, we opted for using the Viola-Jones detection technique. With this
technique, some "basic" features are used to train a cascade classifier, which
consist of several "weak" classifiers, boosted by the appending of one afther
the other. 

In order to train the classifiers, sections such as the one shown in the figure
above were cropped from each of the 14 radiographs, for the positive data, and,
as for the negative data, 150 random images were gathered. Each image
(regardless positive or negative), was denoised and greyed before being used for
training. 

As for how the training was made, first, an \textit{out.vec} file was created with the
tool \textit{createsamples} from openCV, and the set of images, together with a list
of anotations for the positive samples. Once having the file, the next step
is to use the tool \textit{opencv\_traincascade}, in order to create the
corresponding XML file with the classifier. Due to the amount of data not
being too large, we choose to make it a 3-stage classifier (more would have been
not efficient, due to the time to train it, and not improving too much, due to
having a low quantity of samples)

The results obtained are good enough, but not perfect. The gist of
the Viola-Jones technique is that it is quite fast, but it is not flawless, and
it found quite some false positives, as shown in the image below

\begin{figure}[h]
  \centering
  \includegraphics[height=6cm]{img/teeth_detection_1}
  \caption{Initial results of Viola-Janes detection}
\end{figure}

As can be seen, there is one very good match, and several bad matches. For this
matter, what we did in order to correct the results are two things, 
first, detection-wise, we tinkered with the detection parameters, changing the
scale at which the image would be resized for further detections, and the
minimum number of neighbours, which, if changed to a high value, it would result
in few detections, but of higher quality, which is what we are interested in.
Result-wise the change made to improve the detection were, 
delete those that are not sufficiently large. 
With these two modifications, we have a result such as
this

\begin{figure}[h]
  \centering
  \includegraphics[height=6cm]{img/teeth_detection_2}
  \caption{Improved results}
\end{figure}

Once we have a proper automatic detection mechanism, all that remains is to place
the shape in its correct position. For this matter, a small choosing technique
was developed:
\begin{itemize}
  \item If the incisor is one of the upper four, the $y$ position is located at
the first third of the rectangle. For the $x$ centroid, the width is divided in 4,
and the centroid will be the center of one of them (corresponding to the
incisor)
  \item On the other hand, if the incisor is one of the lower four, the $y$
centroid is located slightly below the second third of the height. The $x$
position in this case is trickier. The lower incisors are usually smaller
(altogether) than the upper ones, so a different mechanism has to be made. For
this matter, instead of dividing the width by 4, it was dividived by 8, and the
first two, and the last two areas are not going to be selected. Meaning, the
incisors will be placed at one of the middle 4 areas, out of the division of 8
made.  
\end{itemize}
